\section{Теорема Фубини}
  Сначала мы докажем предварительную теорему, а потом уже теорему Фубини. Рассмотрим $S_k$ "--- полукольцо в $X_k$, где $k=1,\dots, n$. И рассмотрим прямое произведение этих полуколец $S:= S_1\times\dots\times S_n = \{ A = A_1\times\dots\times A_n\mid A_k\in S_k,k=1,\dots,n\}$. Мы сейчас докажем, что это тоже полукольцо. Пусть у нас ещё заданы меры на каждом полукольце $m_k\colon S_k\to\R_+$. Тогда можно ввести понятие прямого\footnote{Будет ещё другое произведение мер, поэтому слово прямое не будем опускать.} произведения мер $m = m_1\times \dots\times m_n$, где $m(A):= m_1(A_1)\dots m_n(A_n)$, если $A = A_1\times\dots\times A_n$.

\begin{The}
  Если $m_k\colon S_k\to\R_+$ есть $\sigma$-аддитивные меры на полукольцах $S_k$ при $k=1,\dots,n$, то $S=S_1\times \dots\times S_n$ является полукольцом и $m=m_1\tds m_n$ является $\sigma$-аддитивной мерой.
\end{The}
\begin{Proof}
 Приведём доказательство для $n=2$, далее по индукции. Пусть $S=S_1\times S_2$ "--- полукольцо. Берём два множества
\[
  A = A_1\times A_2,\ B=B_1\times B_2\in S,\pau A_1,B_1\in S_1,\ A_2,B_2\in S_2.
\]
Легко проверяется, что
\[
  A\cap B = (A_1\cap B_1)\times (A_2\cap B_2).
\]
Можно нарисовать картинку в виде двух прямоугольников.

Теперь разность представляется в виде трёх слагаемых
\[
  A\dd B = \big((A_1\dd B_1)\times (A_2\dd B_2)\big)\sqcup
	   \big((A_1\dd B_1)\times (A_2\cap B_2)\big)\sqcup
	   \big((A_1\cap B_1)\times (A_2\dd B_2)\big).
\]
Это тоже можно показать, нарисовав картинку из двух прямоугольников. Таким образом, $S$ "--- полукольцо.

Осталось показать, что произведение мер является $\sigma$-аддитивной мерой. Пусть множество $A$ представляется в виде
\[
  A = \DUN l1m B^{(l)},\pau A = A_1\times A_2,\ B^{(l)} = B_1^{(l)}\times B_2^{(l)}.
\]
Давайте запишем такую функцию
\[
  f_l(x_1):=m_2(B_2^{(l)})\cdot\chi_{B_1^{(l)}}(x_1),\pau x_1\in A_1.
\]
Из этого определения вытекает, что $A_2 = \UN l1m B_2^{(l)}$, но не обязательно дизьюнктное. Отсюда вытекает такое равенство
\[
  m_2(A_2) = \RY l1m f_l(x_1),\pau x_1\in A_1.
\]
Пусть $\mu_1$ "--- продолжение меры $m_1$. Мы сейчас будем писать интеграл и подставлять определение нашей функции.
\[
  m(A):=m_1(A_1)\cdot m_2(A_2) = \Gint{A_1} m_2(A_2)\,d\mu_1 = \RY l1m \I{A_1}{f_l(x_1)}_1 = \RY l1m m_1( B_1^{(l)})\cdot m_2(B_2^{(l)}).
\]
Для $m=\infty$ нужно лишь применить теорему о монотонной сходимости. Выкладка та же самая.
\end{Proof}

\begin{Def}
  Пусть у нас заданы измеримые пространства $(X_k,\E_k,\mu_k)$, $k=1,\dots,n$. Тогда мы можем построить 
\[
  X = X_1\tds X_n,\  S = \E_1\tds \E_n,\ m=\mu_1\tds \mu_n.
\]
Если построить внешнюю меру и ограничить на $\E$, то $m^*\big|_\E = \mu$ и тройка $(X,\E,\mu)$ называется произведением измеримых пространств.
\end{Def}

Это произведение обладает свойством ассоциативности. Будем обозначать это произведение не как прямое, а как тензорное
\[
  \mu := \mu_1\ods\mu_n.
\]

Свойство ассоцативности тогда записывается так
\[
  (\mu\otimes\mu_2)\otimes \mu_3 = \mu\otimes(\mu_2\otimes \mu_3).
\]
Свойство ассоциативности вытекает из ассоциативности прямого произведения. Мы для простоты изложения далее будем рассматривать случай $n=2$.

Пусть $(X,\E_X,\mu_X)$ и $(Y,\E_Y,\mu_Y)$ "--- измеримые пространства. Тогда для $Z = X\times Y$, $\mu = \mu_X\otimes mu_Y$, $E\in\E$ обозначим сечения
\[
  E_X = \big\{y\in Y\big|(x,y)\in E\big\},\pau E_Y = \big\{x\in X\big|(x,y)\in E\big\}.
\]

Сечение объединений будет объединением сечений, относительно пересечения и разности так же. То же самое можем сделать для функций
\[
  f\colon E\to\R,\pau f_x(y) = f(x,y),\pau f_y(x) = f(x,y).
\]

\begin{The}
  Если $E\in \E$ $\sigma$-конечной меры, то 
  \[
    \mu(E) = \I X{\mu_y(E_x)}_x = \I Y{\mu_x(E_y)}_y.
  \]
\end{The}

Вообще говоря, не все сечения будут измеримы, функция будет определена почти всюду. Где функция неопределена, положим её равной нулю, это не повлияет на значение интеграла.

\begin{Proof}
Доказательство будет проходить в несколько шагов.
\begin{enumerate}
  \item $E = A\times B$, $A\in\E_x$, $B\in \E_y$. Тогда
\[
  \mu(E) = \mu_x(A)\cdot \mu_y(B) = \I A{\mu_y(B)}_x = \I A{\mu_x(A)}_x.
\]
Это равенства симметричны, мы будем доказывать только одно из них.
\[
  \forall\ E\in\Rim(S),\pau S = \E_x\times \E_y.
\]
  \item $\mu(E)<\infty$. Построим измеримую оболочку $A$ множества $E$ (была лемма об измеримой оболочке).
\[
  A = \caP k1A_k,\pau E\subset A_k,\pau A_k = \uN l1A_{kl},\pau A_{kl}\in S, \mu(A_k\dd E)<\frac1k.
\]
Из этого вытекает, что $\mu(A\dd E)=0$. Введём теперь следующие множества
\[
  B_n := \CAP k1n A_k,\pau D_{nm}:=\CAP k1n\UN l1m A_{kl} \in S.
\]
 Так как оба $\in S$, для них уже теорема доказана. Кроме того, $B_n\searrow A$ при $n\to\infty$, а $D_{mn}\nearrow B_n$ при $m\to \infty$. Теперь осталось применить свойства непрерывности меры снизу и сверху. А так как для множеств из полукольца теорема доказана, то и для наших множеств будет доказана. Ну и $\mu(A\dd E) = 0$. Значит, надо доказать ещё для множеств меры нуль.

Пусть $B = E\dd A$, $\mu(B) = 0$. Берём точно так же измеримую оболочку $C$ этого множества $C\supset B$. Для этой измеримой оболочки мы уже доказали теорему. Имеем интеграл
\[
  \I X{\mu_y(C_x)}_X = \mu(C) = \mu(B) = 0.
\]
Так как $C\supset B$, то и $C_x\supset B_x$. И таким образом, мы доказали теорему полность для множества конечной меры.

Если множества $\sigma$-конечной меры, мы представляем их в виде счётного объединения конечной меры.
\end{enumerate}
\end{Proof}

Теперь то, что оставалось без доказательства: про функцию распределения. Это как пример применения этой теоремы. Пусть $(X,\E,\mu)$ "--- измеримое пространство. На множестве $E\in\E$ задана неотрицательная измеримая функция $f\colon E\to \R_+$. Рассмотрим множество-подграфик 
\[
  G = \big\{(x,t)\big|0\le t\le f(x)\big\}\subset X\times \R_+.
\]
Позже мы докажем, что подграфик измеримой функции есть измеримое множество. А сейчас запишем его меру, как интегралы по сечениям
\[
  \mu(G) = \I Ef = \int\limits_0^\infty \mu(G_t)\,dt = \int\limits_0^\infty \lambda_f(t)\,dt,
\]
где $G_t$ "--- функция распределения, а $\lambda_f(t) = \mu(G_t)$.

\begin{Lem}
  Пусть $f\colon E\to\R_+$ измерима. Тогда её подграфик $G = \big\{(t,x)\big|0\le t\le f(x)\big\}\subset X\times\R_+$ является измеримым относительно произведения мер $\mu\times dt$.
\end{Lem}

\begin{Proof}
  Давайте введём множества $H_k^n = E\left(\frac{k-1}{2^{n}},f,\frac k{2^n}\right)$ (множество точек $x$, для которых выполняется неравенство) и функции $h_n(x) = \RY k1\infty \frac k{2^n}\chi_{H_k^n}(x)> f(x)$. Была у нас лемма  о том, что $h_n\searrow f$.

У функции $h_n$ подграфик измерим, а подграфик функции $f$ будет пересечением этих подграфиков. А пересечения измеримых измеримы.
\end{Proof}

Работаем в тех же обозначениях для произведения измеримых пространств.
\begin{The}[Фубини]
  Если $E\in\E$ $\sigma$-конечной меры и $f\in L(E,\mu)$, то 
   \[
  \I Ef = \I X{\I{E_x}{f_x}_y}_x = \I Y{\I{E_y}{f_y}_x}_y.
\]
То есть интеграл по произведению мер равен повторному интегралу.
\end{The}

\begin{Proof}
  Представим $f$ в виде разности неотрицательных функций $f = f_+-f_-$, где $f_\pm\ge0$. Это даёт нам право без ограничения общности считать, что $f\ge 0$. Обозначим $\lambda = \mu\otimes dt = \mu_x\otimes \mu_y\otimes dt$ в силу ассоциативности. Ещё обозначим $\nu = \mu_y\otimes dt$. Тогда $\lambda = \mu_x\otimes \nu$. Мера задана на множестве $X\times Y\times \R_+$.

Рассмотрим подграфик $G = \big\{(x,y,t)\big|0\le t\le f(x,y)\big\}\subset X\times Y\times \R_+$. Мы доказали, что $G$ измеримо относительно меры $\lambda$.

Теперь давайте вычислять меру этого множества разными способами. Первый спобос: фиксируем $(x,y)$
\[
  \lambda(G) = \I Ef.
\]
С другой стороны можем фиксировать переменную $x$. Тогда будет подграфик сечения функции
\[
  \lambda(G) = \I Ef = \I X{\nu(G_x)}_X.
\]
Но сам этот подграфик мы тоже можем вычислить с помощью сечений.
\[
\lambda(G) = \I Ef = \I X{\nu(G_x)}_X = \I X{\left(\I{E_x}{f_x}_y\right)}_x.
\]
А второе равенство доказывается симметрично.
\end{Proof}

А теперь рассмотрим меру Лебега на $\R^n$. Рассмотрим $n$ экземпляров измеримых пространств $(\R,\E_k,\mu_k)$ Лебега в $\R$, $k=1\dots,n$. Тогда можем рассмотреть измеримое пространство в $\R^n$
\[
  (\R^n,\E,\mu),\pau \mu = \mu_1\ods\mu_n.
\]

Можно было по-другому определять, а именно сразу рассмотреть полукольцо. Но у нас была теорема единственности меры, значит, мы бы получили то же самое.

  Пусть $\Delta = [a_1,b_1]\tds[a_n,b_n]$ "--- $n$-мерный отрезок. Будем обозначать $R(\Delta)$ "--- множество функций, измеримых по Риману, а $L(\Delta)$ "--- множество функций, интегрируемых по Лебегу на этом отрезке. Будем рассматривать только ограниченные функции $f\colon \Delta\R$. Для заданной функции определим функции Бэра
\[
  \ul f(x): = \yo r0\inf\limits_{x\in\Delta\cap S_r(x)}f(x),\pau \ol f(x) = \yo r0\sup\limits_{x\in\Delta\cap S_r(x)}f(x).
\]
Эти функции измеримы, поскольку множества $\Delta(\ul f>c)$ и $\Delta(\ol f<c)$ тех точек отрезка, для которых $\ul f>c$ и множество, где $\ol f<c$ открыты для любого $c\in \R$.


Нижняя функция будет совпадать с верхней в точке $x$, если и только если функция непрерывна в $x$.
\begin{The}[Лебега о сравнении интегралов Римана и Лебега для $n$-мерного отрезка]
  Пусть функция $f\colon \Delta\to \R$ ограничена. Тогда $f\in\R(\Delta)\iff \mu(E_1) =0$, где 
\[
  E_f = \big\{x\in\Delta\big| \ul f(x)\ne\ol(x)\big\}.
\]

 Если $f\in R(\Delta$, то $f\in L(\Delta)$ и $\I[x]\Delta {f(x)} = \I\Delta f$.
\end{The}

\begin{Proof}
  Сначала напишем одно из необходимых и достаточных условий интегрируемости. Когда нижний интеграл Дарбу совпадает с верхним. Мы устраиваем разбиение $\tau = \ar\Delta l1n$ отрезка $\Delta$, внутренности элементов которого не пересекаются, то есть $\overcirc\Delta_l\cap\overcirc\Delta_{l'}=\q$ при $l\ne l'$, а $\Delta = \UN l1m\Delta_l$.
\[
  \ul D_\tau(f) = \RY l1m \ul a_l\mu(\Delta_l),\ \ul a_l = \inf\limits_{\Delta_l}f(x),\quad
  \ol D_\tau(f) = \RY l1m \ol a_l\mu(\Delta_l),\ \ol a_l = \sup\limits_{\Delta_l}f(x).
\]
Условие выглядит так
\[
  \I[x]-{f(x)} = \sup\limits_\tau \ul D(f) = \inf\limits_\tau \ol D_\tau(f) = \int\limits^- f(x)\,dx.
\]

Пусть $\tau_k = \ar {\Delta^{(k)}}l1{m_k}$ "--- последовательность разбиений, удовлетворяющая условиям
\begin{enumerate}
  \item Диаметр $f(\tau_k)\to 0$;
  \item $\tau_k\supset \tau_{k+1}$;
  \item $\I[x]-{f(x)} = \yo k\infty \ul D_{\tau_k}(f) = \yo k\infty\RY k1{m_k}\ul a_l^{(k)} \mu(\Delta_l^{(k)})$.
\end{enumerate}

Функции $h_k(x)=\RY l1{m_k}\ul a_l^{(k)}\chi_{\Delta_l^{(l)}}(x)\nearrow \ul f(x),\ \forall\ x\in \overcirc\Delta_l^{(k)},\ \forall\ k,l$. Значит, сходится почти всюду и по одной из теорем имеем
\[
  \I[x]-{f(x)} = \yo k\infty\RY l1{m_k}\ul a_l^{(k)}\mu(\Delta_l^{(k)}) = \yo k\infty\I\Delta {h_k} = \I\Delta{\ul f}\,d\mu.
\]
Отсюда мы получаем равенства
\[
  \I[x]-{f(x)} = \I\Delta{\ul f},\pau \int\limits^-f(x)\,dx = \I\Delta{\ol f}.
\]
Мы можем их объединить
\[
  \I\Delta{\underbrace{(\ol f-\ul f)}_{\ge0}},\pau \ul f(x)\le f(x)\le \ol f(x).
\]
Откуда мы получаем, что $\ul f(x)-\ol f(x) = 0$ почти всюду на $\Delta$, $\ul f(x) = f(x) = \ol f(x)$ почти всюду на $\Delta$. И
\[
  \I[x]\Delta {f(x)} = \I\Delta f.
\]
\end{Proof}

Сейчас мы построим функцию, которая не интегрируема по Лебегу. То есть никакая ей эквивалентная не интегрируема по Риману. Берём отрезок $[0,1]$, набор $\{r_n\} = \Q\cap[0,1]$ и число $0<\e<1$. Положим
\[
  A_\e = \uN n1 (r_n-\e_n,r_n+\e_n),\pau \e_n = \frac\e{2^{n+1}}.
\]
Легко сверху оценить меру $\mu(A_\e)\le \rY n1 2\e_n = \e$. Мера будет маленькой, но положительной. Положим
\[
 B_\e = [0,1]\dd A_\e.
\]
Это замкнутое множество, которое состоит только из иррациональных чисел. Оно нигде не плотно. Ну и мера этого множества $\mu(B_\e)\ge 1-\e$. Теперь достаточно взять функцию
\[
  f(x) = \chi_{B_\e}(x).
\]
И сама функция не интегрируема по Риману, и её нельзя изменить на множестве меры нуль так, чтобы она стала интегрируемой по Риману.
